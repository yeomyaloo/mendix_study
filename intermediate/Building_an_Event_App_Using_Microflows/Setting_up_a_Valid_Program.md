# 서브 마이크로플로우 사용하기
### 마이크로플로우와 서브마이크로플로우
- 마이크로플로우는 그 사용 방법과 무수한 기능 덕분에 매우 복잡해질 수 있습니다.
  - 이를 통해 복잡한 프로세스를 구축할 수 있습니다. 그렇다면 이러한 마이크로플로우를 어떻게 제어할 수 있을까요?
### 마이크로플로우 제어를 위한 서브마이크로플로우
- Mendix에서는 마이크로플로우가 다른 마이크로플로우에 의해 호출될 수 있습니다.
- 다른 마이크로플로우에 의해 호출되는 마이크로플로우를 서브 마이크로플로우(sub-microflow)라고 합니다.
- 이는 상위 마이크로플로우의 하위 섹션입니다.

### 서브 마이크로플로우의 도움
- 서브 마이크로플로우를 사용하면 가독성을 개선할 수 있으며, 복잡한 마이크로플로우의 (일부) 재사용과 유지 관리가 더 쉬워집니다.
- 재사용성을 최대한 활용하기 위해, 서브 마이크로플로우가 수행해야 할 작업과 이를 사용할 위치를 결정해야 합니다.
- 이를 통해 서브 마이크로플로우가 요구되는 활동을 수행할 수 있도록 어떤 정보를 전달해야 하는지 알 수 있습니다.
- 입력 매개변수가 많을수록 의존성이 증가하며, 마이크로플로우의 재사용이 어려워질 수 있습니다.

## 1. ProgramItem 엔티티 생성하기
프로그램을 생성하기 위해, `EventManagement` 모듈의 도메인 모델에 새로운 엔티티를 추가해야 합니다. 이 엔티티를 `ProgramItem`이라고 부릅시다.

### 1.1 `ProgramItem` 속성
`ProgramItem`은 다음 속성들을 가져야 합니다:
- (속성 목록을 여기에 추가하세요)
![image](https://github.com/user-attachments/assets/6db83ef9-eb31-4ba7-b322-08540f1405ef)

### 1.2 참조
또한, 다음과 같은 1-* 참조가 있어야 합니다:
- (참조 목록을 여기에 추가하세요)
![image](https://github.com/user-attachments/assets/0d671336-2a9c-4ac6-8bf0-391a4367ecf9)

### 1.3 도메인 모델
도메인 모델은 다음과 유사해야 합니다:
(도메인 모델 그림을 여기에 추가하세요)
![image](https://github.com/user-attachments/assets/5184f169-b083-43a2-a81b-4c1a4f3dd3a4)

### 1.4 페이지 생성
이제, 이전에 했던 것처럼 `ProgramItem` 엔티티의 개요 및 NewEdit 페이지를 생성하세요.

### 1.5 탐색 항목 추가
그 다음, Program 개요 페이지로 연결되는 탐색 항목을 추가합니다. 이렇게 하면 이벤트 관리자가 프로젝트 탐색에서 `ProgramItem` 객체를 유지할 수 있습니다.

### 1.6 접근 권한 설정
마지막으로, 엔티티 및 페이지에 적절한 접근 권한 규칙을 설정해야 합니다. `EventManager` 역할에 접근을 허용하되, 방문자 수는 프로그램마다 자동으로 유지되므로 `EventManager`가 실수로 변경하지 않도록 해야 합니다. 이벤트 관리자는 새 객체를 생성하고 기존 객체를 삭제할 수 있어야 합니다.

## 2. 프로그램 유효성 검사
프로그램 항목을 유지 관리하는 페이지를 설정한 후, 이벤트 관리자가 입력할 프로그램 정보에 유효성 검사를 추가하고 싶습니다.

이를 위해, 도메인 모델의 `ProgramItem` 엔티티에 커밋 전 이벤트를 추가하세요. 참고로, Rapid Developer 학습 경로의 Event Handlers 강의를 검토할 수 있습니다.

이벤트 핸들러를 생성할 때 ‘마이크로플로우가 false를 반환하면 오류를 발생시킵니다’를 체크 해제해야 합니다. 이는 기본 오류 메시지가 아닌 자체 알림을 제공하고자 하기 때문입니다. 만약 자체 오류 메시지를 사용하지 않는 다른 시나리오가 있다면 이 체크박스를 체크한 상태로 두어도 됩니다.

이제 이벤트 핸들러를 생성한 후, 이 이벤트에 해당하는 마이크로플로우 (`BCO_ProgramItem`)를 생성합니다.

### 2.1 필드 유효성 검사
먼저, 아래 항목들이 입력되었는지 확인해야 합니다:
- 제목이 입력되었나요?
- 설명이 입력되었나요?
- 시작 시간이 입력되었나요?
- 종료 시간이 입력되었나요?
- 아티스트가 선택되었나요?
- 날짜가 선택되었나요?
- 무대가 선택되었나요?

#### 2.1.1 필드 유효성 검사 마이크로플로우
유효성 검사를 위한 항목을 추가하기 전에, Boolean 변수를 생성하여 처음에는 `true`로 설정하고, 항목 필드가 비어 있을 경우 `false`로 변경하세요. 해당 항목이 채워져야 함을 나타내는 유효성 검증 피드백을 추가하는 것을 잊지 마세요.
각 필드를 검증하고 마이크로플로우는 다음과 같은 형태가 될 것입니다:
![image](https://github.com/user-attachments/assets/e5d883eb-87cf-41fa-b3ad-be6d4235641b)

### 2.2 추가 유효성 검사
모든 필드가 비어 있지 않은 것을 확인한 후, 다음 항목들도 검증합니다:
- 시작 시간이 종료 시간보다 작은가요?
- 시작 시간과 종료 시간이 선택된 날짜의 시간 내에 있는가요?

다음과 같은 결정을 추가하여 시작 시간이 선택된 날짜 내에 있는지 검증합니다:
- `$ProgramItem/StartTime > $ProgramItem/EventManagement.ProgramItem_Day/EventManagement.Day/StartDate`
- `$ProgramItem/StartTime < $ProgramItem/EventManagement.ProgramItem_Day/EventManagement.Day/EndDate`

#### 2.2.1 종료 시간을 검증하는 마이크로플로우
- 마지막으로, 종료 시간이 선택된 날짜 내에 있는지 검증합니다.
- 모든 유효성 검사를 확인하는 마이크로플로우를 완료하면, 아래와 같은 큰 마이크로플로우가 될 것입니다.

### 2.3 접근 권한 설정
- 엔티티 및 페이지에 적절한 접근 권한 규칙을 설정해야 합니다.
- `EventManager` 역할에 접근을 허용하되, 방문자 수는 프로그램마다 자동으로 유지되므로 `EventManager`가 실수로 변경하지 않도록 해야 합니다.
  - 이벤트 관리자는 새 객체를 생성하고 기존 객체를 삭제할 수 있어야 합니다.
![image](https://github.com/user-attachments/assets/1ee7a24f-eac6-4826-8201-f74be6e20547)
