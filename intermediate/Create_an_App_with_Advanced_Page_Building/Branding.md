[Create an App with Advanced Page Building](https://academy.mendix.com/link/modules/183/lectures/1414/3.1-Introduction)
# 학습 목표(Learning Objectives)
이 모듈을 마치면 다음을 할 수 있습니다
- 맞춤형 내비게이션 레이아웃의 중요성을 설명할 수 있다.
- 내비게이션 레이아웃의 주요 요소를 설명할 수 있다.
- 마스터 레이아웃이 무엇인지 정의할 수 있다.
- 맞춤형 내비게이션 레이아웃을 만들 수 있다.
- 내장된 로그인 페이지를 사용하는 것과 직접 만드는 것의 장단점을 비교할 수 있다.
- 맞춤형 로그인 페이지를 만들 수 있다.
- 앱에서 익명 사용자 등록을 활성화할 수 있다

# 소개

모듈 2를 완료하지 못했다면, 페이지 상단에서 프로젝트 패키지 (mpk 파일)를 다운로드하여 이 학습을 계속 진행할 수 있습니다.

잘 작동하고 안전한 애플리케이션만큼 중요한 것이 바로 잘 꾸며진 애플리케이션입니다. Mendix의 스타일링 도구를 사용하여 회사의 브랜드가 잘 표현되도록 하고 훌륭한 사용자 경험을 제공할 수 있습니다. 기본 제공되는 스타일링 요소를 사용할 수 있지만, 사용자 정의 스타일링을 추가할 수도 있습니다. 애플리케이션에 사용자 정의 스타일링을 추가할 때는 두 가지 옵션이 있습니다:

### 1. SASS 변수 변경

Mendix는 **SASS** (Syntactically Awesome Style Sheets)를 사용하여 기존 스타일링을 신속하게 변경할 수 있으며, 이는 **CSS** (Cascading Style Sheets)로 컴파일됩니다. CSS는 웹 페이지의 레이아웃을 포맷하는 데 사용되며, 이 경우 Mendix 애플리케이션의 레이아웃을 포맷하는 데 사용됩니다.

### 2. 사용자 정의 레이어에 새로운 스타일링 추가

SASS 또는 CSS를 사용하여 완전히 새로운 스타일링을 만드는 것도 가능합니다. 이를 위해서는 직접 코드를 작성해야 하며, 이는 전문가 기능으로 간주됩니다.

---

이전 모듈에서, 팀원을 관리할 수 있는 Expenses 앱의 기반을 구축했습니다. 이제 Andrea는 사용자가 애플리케이션에서 로그아웃하고, 시스템에 계정이 없는 경우 등록할 수 있도록 하기를 원합니다. 이를 위해 다음이 필요합니다:

1. **애플리케이션의 테마 업데이트**: SASS 변수를 변경하고 이를 CSS로 컴파일하여 회사의 브랜딩에 맞게 업데이트합니다.
2. **사용자 정의 탐색 레이아웃 구축**: 일반 탐색 메뉴를 표시하고, 상단 바에서 로그아웃할 수 있으며, 중요한 정보를 표시하는 동적 헤더를 포함합니다.
3. **사용자 정의 로그인 페이지 생성**: 사용자가 새 계정을 만들거나 기존 계정으로 로그인할 수 있도록 합니다.

이를 달성하기 위해, Theme Customizer를 사용하여 스타일링을 사용자 정의하고 SASS 변수를 변경하는 방법을 배울 것입니다.

# 커스텀 내비게이션 레이아웃(Custom Navigation Layouts)
## 1. 필요성
레이아웃은 페이지에서 무엇이 어디에 위치하는지를 지정합니다. 이를 통해 애플리케이션 디자인에서 더 큰 유연성과 재사용성을 제공합니다. 각 페이지는 레이아웃을 기반으로 하며, 해당 레이아웃에서 반복적으로 나타나는 위젯과 구조를 포함합니다. 예를 들어, 애플리케이션 로고를 레이아웃에 배치하면, 해당 레이아웃을 사용하는 모든 페이지에서 로고가 표시됩니다.

레이아웃은 애플리케이션의 사용자 인터페이스를 구조화하여 일관된 레이아웃으로 신속하게 익숙해지도록 돕고, 재사용을 통해 유지보수성을 높여줍니다. 익숙함은 혼란을 줄여줍니다. 무언가에 익숙할수록 어떻게 반응해야 할지 고민할 필요가 줄어듭니다. 예를 들어, 문을 마주했을 때 손잡이를 잡는 것이 본능적으로 떠오르고, 문을 발로 차려고 하지 않는 것이 대표적인 예입니다. 이는 인간의 기본적인 본능으로, 저항이 적은 길을 찾으려는 성향입니다.

각 레이아웃은 수천 번 재사용될 가능성이 있으며, 이를 통해 디자인 유지보수를 줄일 수 있습니다. 레이아웃에서 변경을 한 번만 하면, 그 레이아웃을 사용하는 모든 페이지에 자동으로 적용되므로 시간과 노력을 아낄 수 있습니다. 예를 들어, 10개의 페이지가 동일한 레이아웃을 사용하고 있고, 왼쪽 사이드바를 추가하려는 경우, 10곳에서 각각 변경하는 대신 한 곳의 레이아웃에서만 변경하면 되므로, 시간과 노력을 절약할 수 있습니다.
## 2. 커스텀 내비게이션 제공
Atlas UI는 기본적으로 세 가지 내비게이션 레이아웃을 제공합니다:
- Atlas Default (사이드바에 내비게이션 메뉴가 있는 레이아웃)
- Atlas Topbar (상단바에 내비게이션 메뉴가 있는 레이아웃)
- Popup (전체 너비 페이지 대신 팝업 페이지)
예를 들어, 사이드바와 상단바가 모두 있는 앱을 원한다면, 커스텀 내비게이션 레이아웃을 만들어야 합니다.

## 3. 내비게이션 레이아웃의 기본(The Basics of a Navigation Layout)
### 3.1 레이아웃은 다음과 같은 중요한 구성 요소로 이루어져 있습니다:
#### 3.1.1 스크롤 컨테이너 (Scroll Containers)
- 스크롤 컨테이너는 레이아웃을 개별 영역(예: 헤더, 사이드바, 푸터)으로 나누고, 이러한 영역의 스크롤 동작을 설정하는 데 사용됩니다.
- 스크롤 컨테이너는 반드시 최상위 위젯이어야 하므로, 레이아웃을 구조화할 때 항상 스크롤 컨테이너로 시작해야 합니다.
- 그 외에는 다른 스크롤 컨테이너에 직접적으로만 배치할 수 있습니다.
- ![image](https://github.com/user-attachments/assets/793ad586-1a3a-4a3b-a96d-0072b86dc67b)
    - 해당 작업을 위해서 위젯에서 scroll container를 선택해서 드래그 해주어야 합니다.   

#### 3.1.2 내용 (Contents)
- 내용은 내비게이션 바부터 로그아웃 버튼까지, 레이아웃을 사용하는 모든 페이지에 있어야 하는 모든 요소를 포함합니다.

#### 3.1.3 자리 표시자 (Placeholders)
- 자리 표시자는 레이아웃을 사용하는 페이지가 비워진 상태로 남아있는 빈 영역입니다.
- 이러한 영역은 페이지의 고유한 부분을 덮는 캔버스 역할을 합니다.
- Mendix에서는 적어도 하나의 자리 표시자 이름을 ‘Main’으로 지정해야 한다고 규정하고 있습니다.
레이아웃을 기반으로 페이지를 생성할 때, 레이아웃의 내용은 동일하게 유지되며, 자리 표시자 영역이 페이지에 고유한 부분을 덮습니다.
![image](https://github.com/user-attachments/assets/e681f33e-4367-4e4e-8fdf-b0b0f80ada85)

## 4. 마스터 레이아웃
### 4.1 의의
- 레이아웃은 다른 레이아웃을 기반으로 할 수 있으며, 이 경우 부모 레이아웃을 마스터 레이아웃이라고 합니다.
- 레이아웃에 마스터가 있으면, 마스터에서 정의한 자리 표시자를 사용하여 더 전문화된 구성을 만들 수 있습니다.
- 페이지가 이 전문화된 레이아웃을 기반으로 하면, 새로운 레이아웃에서 정의한 자리 표시자만 사용할 수 있으며, 마스터 레이아웃의 자리 표시자는 사용할 수 없습니다.
-  마스터 레이아웃은 애플리케이션 디자인의 재사용을 더욱 확대하며 프로젝트의 유지보수를 개선합니다.
-  마스터 레이아웃을 통한 재사용을 활용하면, 프로젝트에 DRY(Do not Repeat Yourself) 원칙을 적용하여 이미 생성한 요소의 중복을 줄일 수 있습니다.
-  이는 디자인 및 유지보수의 제어를 가능하게 합니다.
### 4.2 예시 
예를 들어, 마스터 레이아웃이 헤더만 정의하고, 파생된 레이아웃(마스터 레이아웃을 사용하는 레이아웃)이 사이드바를 추가하는 경우, 페이지는 마스터 레이아웃 또는 파생된 레이아웃을 기반으로 할 수 있으며, 마스터 레이아웃에 대한 변경 사항은 이 레이아웃을 사용하는 모든 페이지에 반영됩니다.

이러한 레이아웃 체인은 필요에 따라 길어질 수 있지만, UX 디자인 관행과 단순성의 중요성을 고려하여(UX 및 UI 디자인에서 중요한 가치), 최대 3개의 레이아웃을 권장합니다.

## 5. 커스텀 네비게이션 레이아웃 만들기
커스텀 네비게이션 레이아웃이 어떻게 작동하는지, 그리고 언제 필요한지 이해했으니, 이제 North Sea Shipbuilders 애플리케이션을 위해 하나를 만들어보겠습니다.

### 5.1 사용 예제
1. **새 레이아웃 생성하기:**
   - App Explorer에서, Expenses 모듈의 Resources 폴더를 오른쪽 클릭하고 `Add other > Layout`을 선택합니다.
   - 새 레이아웃의 이름을 `Atlas_Custom`으로 지정합니다.
   - `OK`를 클릭합니다.
   - Properties 창에서, 마스터 레이아웃을 `Atlas_TopBar`로 설정합니다. 이렇게 하면 네비게이션 레이아웃이 `Atlas_TopBar` 레이아웃을 상속받아 작업이 간편해집니다!
    ![image](https://github.com/user-attachments/assets/03708d38-714f-47d1-9991-1973cd57615c)

2. **동적 헤더 추가하기:**
   헤더에는 앱의 모든 페이지에서 두 가지 정보를 표시해야 합니다:
   - 일반 직원용: 총 요청한 금액과 그 중 승인된 금액
   - 재무 직원용: 모든 직원이 요청한 총 금액과 그 중 승인된 금액
   또한, 직원들이 새로운 요청을 생성할 수 있도록 `Add Expense` 버튼을 추가할 것입니다.

   네비게이션 레이아웃에 직접 동적 데이터를 추가할 수는 없지만, 데이터를 표시하는 스니펫을 사용하면 가능합니다. 스니펫과 헤더를 생성하되, 나중에 학습 경로에서 이를 동적으로 업데이트할 예정입니다.

3. **헤더 공간 추가하기:**
   - 스크롤 컨테이너의 속성에서 상단 영역을 활성화하여 헤더 공간을 추가합니다.

4. **구성 모드로 전환 후 스니펫 호출 위젯 추가하기:**
   - 구성 모드로 전환하여 네비게이션 레이아웃의 상단 영역에 스니펫 호출 위젯을 배치합니다.
   > 참고: 디자인 모드에서는 이 기능이 Mendix 버전 10.3.0에서 지원되지 않습니다. -> 10.14.0 버전을 사용하고 있어서 모드를 바꿔서 드래그해줬
    ![image](https://github.com/user-attachments/assets/029f776c-e01b-4935-847b-c3160ffc7b33)

5. **새 스니펫 생성하기:**
   - Expenses 모듈의 Resources 폴더에서 `HeaderExpenses`라는 새 스니펫을 생성합니다. 이 스니펫은 나중에 학습 경로에서 업데이트할 것입니다.

6. **디자인 모드로 돌아가서 홈 페이지 설정하기:**
   - 디자인 모드로 돌아가서 홈 페이지에 새 `Atlas_Custom` 네비게이션 레이아웃을 설정합니다.
           - ![image](https://github.com/user-attachments/assets/c116a1f3-c89a-4d63-a11c-c41b30c921eb)
   - 홈 페이지에서 기존 헤더를 삭제합니다. 그렇지 않으면 홈 페이지에 두 개의 헤더가 표시됩니다.
7. App 모듈의 Navigation 메뉴를 열어 `Sign out` 버튼을 추가합니다. 버튼의 클릭 동작은 `Sign out`으로 설정합니다.

# 커스텀 로그인 페이지
## 1. 개요
- 모든 Mendix 애플리케이션에는 기본 로그인 페이지가 있습니다
    - ![image](https://github.com/user-attachments/assets/cfd11597-b895-4188-a753-313805cc66e3)
- 하지만, 다른 디자인의 로그인 페이지가 필요하거나, 사용자가 계정을 생성할 수 있는 페이지가 필요하다면 두 가지 방법으로 로그인 페이지를 변경할 수 있습니다:

## 2. 사용 예제
1. **커스텀 login.html 파일 만들기**
2. **기본 제공 커스텀 로그인 페이지 사용하기**

이제 두 가지 방법의 작동 방식과 장단점을 살펴보겠습니다.

#### 1. 커스텀 login.html
- 커스텀 로그인 페이지를 만드는 한 가지 방법은 기본 로그인 페이지를 대체하는 커스텀 `login.html` 파일을 만드는 것입니다.
- 이 방법은 HTML을 작성해야 하기 때문에 전문가 기능으로 간주됩니다.

**장점:**
- 익명 사용자 접근을 허용할 필요가 없어 보안이 매우 우수합니다.
- 로그인 후 Mendix 앱이 로드되어 앱의 보안이 추가됩니다.

**단점:**
- 이 페이지를 작성하려면 HTML을 알아야 합니다.

#### 2. 기본 제공 커스텀 로그인 페이지
- 커스텀 로그인 페이지를 만드는 두 번째 방법은 기본 제공 커스텀 로그인 페이지를 사용하는 것입니다.
- 이 기능은 Mendix 애플리케이션에 기본으로 제공되며, 커스텀 `login.html` 솔루션보다 사용하기 쉽지만, 보안에 더 신경 써야 합니다.
- 이유는 익명 사용자에게 앱 접근을 허용해야 하기 때문입니다.

**장점:**
- 사용하기 쉽습니다.
- HTML을 알 필요가 없습니다.

**단점:**
- 익명 사용자를 허용해야 합니다.
- 로그인 전에 전체 Mendix 앱이 로드됩니다.

# 커스텀 로그인 페이지 만들기
- 이 단계에서는 Andrea를 위해 직원들이 로그인하거나 자신들의 계정을 생성할 수 있는 커스텀 로그인 페이지를 만듭니다.

## 1. 로그인 페이지 설정
1. **앱 보안에서 익명 사용자 접근 허용하기:**
   - 새로운 사용자 역할을 생성합니다. 이름: `Anonymous`
   - `Expense` 모듈에 새로운 모듈 역할을 생성합니다. 이름: `Anonymous`
   - 사용자 역할과 모듈 역할이 연결되어 있는지 확인합니다.
   - `App Security`에서 익명 사용자 탭을 열고, 다음 설정을 적용한 후 확인을 클릭합니다.

2. **리소스 폴더에서 새로운 레이아웃 생성하기:**
   - 새 레이아웃을 생성합니다. 이름: `Atlas_Login` 
   - 레이아웃을 그대로 두어 로그인 페이지가 전체 너비의 페이지가 되도록 하고 메뉴 바는 표시되지 않도록 합니다.

3. **Expenses 모듈 내에 새로운 폴더 생성하기:**
   - `Anonymous Users`라는 새로운 폴더를 생성합니다.
   - 그 안에 `Pages`라는 하위 폴더를 생성합니다.

4. **새 페이지 생성하기:**
   - 페이지 이름: `Login`
   - 네비게이션 레이아웃: `Atlas_Login`
   - 템플릿: `Form login` (Forms 내)
   - `App Navigation`에서 새로 생성한 로그인 페이지를 기본 홈 페이지로 설정합니다.

5. **역할 기반 홈 페이지 생성하기:**
   - `Administrator`, `Requestor`, `Approver` 사용자 역할에 대한 홈 페이지를 생성합니다.
   - 타겟을 `Expenses` 모듈의 홈 페이지로 설정합니다.
   - ![image](https://github.com/user-attachments/assets/4fe2f17d-ebbf-4ac9-b62b-7473f46461b6)

6. **인증 섹션에서 새 로그인 페이지를 로그인 페이지로 설정합니다.**

7. **각 사용자 역할에 새로 생성한 로그인 페이지에 대한 접근 권한을 부여합니다.**

# 로그인 페이지 디자인하기(Designing the Login Page)
1. **로그인 페이지 열기**

2. **불필요한 요소 제거하기:**
   - 페이지에서 데이터 뷰 위젯을 찾습니다.
   - 데이터 뷰 위젯을 선택하고 삭제합니다. 이 위젯은 커스텀 로그인 디자인에 필요하지 않습니다.

3. **페이지 헤더 제목 업데이트하기:**
   - 페이지 헤더를 클릭합니다.
   - 속성 창에서 제목 텍스트를 `Welcome to North Sea Shipbuilders Expenses`로 업데이트합니다.

4. **보조 텍스트 업데이트하기:**
   - 보조 텍스트 영역을 클릭합니다.
   - 텍스트를 `Use this app to get your expense requests approved!`로 변경합니다.

5. **컨테이너 스타일링하기:**
   - 텍스트 위젯이 포함된 컨테이너를 클릭합니다.
   - 속성 창에서 `Styling` 섹션으로 이동합니다.
   - `Align content` 속성을 `Left align as a column`으로 설정합니다.

6. **검증 메시지 위젯 추가하기:**
   - 데이터 뷰를 제거한 컨테이너에 `Validation message` 위젯을 드래그하여 배치합니다. 이 위젯은 로그인 검증 오류를 표시하는 데 사용됩니다.

7. **로그인 폼 위젯 추가하기:**
   - `Login id`용 `Text box` 위젯을 드래그하여 컨테이너 아래에 배치합니다.
   - `Password`용 `Text box` 위젯을 `Login id` 텍스트 박스 아래에 배치합니다.

8. **로그인 버튼 구성하기:**
   - `Password` 텍스트 박스 아래에 `Button` 위젯을 드래그하여 배치합니다.
   - 버튼을 다음과 같이 설정합니다:
     - **General Tab:**
       - `Button style`을 `Primary`로 설정합니다.
       - `Validation message widget`을 `ValidationMessage1`로 설정합니다 (이 이름이 검증 메시지 위젯의 이름과 일치해야 합니다).
     - **Appearance Tab:**
       - `Class`를 `btn-block btn-rounded`로 설정합니다.

### 결과
이제 로그인 페이지는 다음과 같이 표시됩니다:
![image](https://github.com/user-attachments/assets/3ca6e3a0-32e5-4584-9f19-d4c1da5b76f6)

# 익명 사용자 등록 허용하기
## 1. 시나리오
현재는 이미 계정이 있는 직원들이 앱에 로그인할 수 있지만, Andrea는 계정이 없는 직원들도 스스로 계정을 만들 수 있기를 원합니다. 이를 위해 몇 가지 중요한 사항이 있습니다:
- 익명 사용자는 데이터에 접근할 수 없어야 합니다.
- Andrea는 오직 North Sea Shipbuilders의 직원만 가입할 수 있도록 보장해야 합니다.
- 가입 후, 직원들은 로그인 페이지로 돌아가 로그인할 수 있어야 합니다.

## 2. 예제
### 2.1 새로운 하위 폴더 생성
1. `Anonymous Users` 폴더에 `Microflows`라는 새 하위 폴더를 만듭니다.

### 2.2 도메인 모델 확장
1. 새로운 `Registration` 엔터티를 도메인 모델에 추가합니다.
   - 이 엔터티는 비영속적이어야 하며, 객체의 정보는 데이터베이스에 저장되기 전에 `Account` 객체로 복사됩니다.
   - 다음과 같은 문자열 속성이 필요합니다: `FullName`, `UserName`, `EmailAddress`, `Password`, `ConfirmPassword`.
   - 익명 사용자에게 모든 속성에 대한 읽기 및 쓰기 권한을 부여합니다.
   - 익명 사용자에게 생성 권한을 부여합니다.

### 2.3 로그인 페이지에 '가입하기' 섹션 추가
1. 로그인 페이지에서 `Sign in` 버튼 아래에 레이아웃 그리드를 추가합니다.
   - 레이아웃 그리드의 클래스는 `spacing-inner-large`로 설정합니다.
2. 새로 생성된 레이아웃 그리드에 컨테이너를 추가하고 `Align content`를 `Center align as a column`으로 설정합니다.
3. 컨테이너에 텍스트 위젯과 버튼 위젯을 추가합니다. 다음 이미지를 참조하여 위젯을 구성합니다.
4. `Sign up here!` 버튼을 클릭하면 새로운 객체가 생성되도록 합니다.
   - `Registration` 엔터티를 객체가 생성될 엔터티로 선택합니다.
   - `Registration_New`이라는 새로운 팝업 페이지를 생성하고 `Anonymous Users > Pages` 폴더에 저장합니다.
   - 익명 사용자에게 페이지 접근 권한을 부여합니다.

### 2.4 `Registration_New` 페이지 설정
1. 비밀번호 필드 두 개의 속성을 `Show as password`로 설정합니다.
2. `Save` 버튼의 캡션을 `Create my account`로 변경합니다.
3. `Create my account` 버튼의 클릭 동작을 마이크로플로우 호출로 설정합니다.

### 2.5 마이크로플로우 생성
1. `ACT_Registration_CreateTeamMember`라는 새 마이크로플로우를 생성하고 `Anonymous Users` 폴더의 `Microflows` 하위 폴더에 저장합니다.
   - 익명 사용자에게 마이크로플로우 접근 권한을 부여합니다.

2. 마이크로플로우를 다음 이미지와 같이 빌드합니다:
![Uploading image.png…]()

   (이미지는 실제 이미지 링크로 교체해야 합니다)

## 3. 추가 정보
- 보통, 이 기능에 이메일로 전송되는 인증 링크를 추가하여 North Sea Shipbuilders의 직원만 계정을 만들 수 있도록 하는 방법을 확장합니다. 이 방법은 `@shipbuildersinc.com` 이메일 주소만 허용하는 정규 표현식과 결합되어 직원만 가입할 수 있도록 합니다.

